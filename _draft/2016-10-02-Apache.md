맥에서 아파치(apache) 웹서버를 실행하는 방법은 인터넷에 자료가 꽤 있지만, [^projectjo]  [^acronym]  [^superakira] 많은 경우 OS X Yosemite 이전 자료라 현재의 설정과는 다른 부분이 많이 있는 것 같습니다. 

현 시점에서는 아파치 웹서버 관련 참고 자료 중에서 [Develop in Mac](http://devmac.tistory.com/11) 블로그 자료가 가장 정확하게 설명되어 있는 자료인 것 같습니다.[^devmac]

### 맥에서 Apache 웹 서버 구동하기

맥에는 기본적으로 apache[^apache] 와 php가 설치되어 있습니다. 따라서 따로 설치 과정은 필요없으며 사용하려면 각 기능을 활성화 해주면 되고, 설정만 변경해 주면 됩니다. 각각의 버전은 다음과 같은 명령어로 확인할 수 있습니다.

```
$ apachectl -v
$ php -v
```

아파치를 시작하는 방법은 아래와 같습니다.

```
$ sudo apachectl start
```

관리자 권한이 필요한 명령어라서 비밀번호를 입력해야 합니다. 

그리고 브라우저 주소창에서 `localhost`를 입력하면 기본 index 페이지가 뜨면서 `It works!`라는 문구가 나타나는 것을 볼 수 있습니다. 기본 index 페이지는 디폴트로 **/Library/WebServer/Documents**에 존재합니다. 해당 폴더에 가면  `index.html.en` 파일이 있음을 확인할 수 있습니다.

아파치의 default 설정들을 변경하려면 **/private/etc/apache2/** 폴더에 있는 설정 파일들을 수정하면 됩니다. 기본 `DocumentRoot` 폴드를 변경하려면 **/private/etc/apache2/httpd.conf** 파일을 열고 `DocumentRoot` 부분과 밑 줄의 `Directory` 부분을 변경하면 됩니다.

```
DocumentRoot "/Library/WebServer/Documents"
<Directory "/Library/WebServer/Documents">
```

[Develop in Mac](http://devmac.tistory.com/11) 블로그 설명에는 `DocumentRoot`를 바꾸지 않고 `userdir`을 활성화 한다고 합니다. `userdir`을 활성화하려면 **/private/etc/apache2/extra/httpd-userdir.conf** 파일을 먼저 수정해야 한다고 합니다.

우선 `$ cd /private/etc/apache2/extra/`로 해당 폴더로 가서 `$ sudo vi http-userdir.conf` 명령으로 파일을 편집합니다. 파일의 내용은 아래와 같습니다.

```
# Settings for user home directories
#
# Required module: mod_authz_core, mod_authz_host, mod_userdir

#
# UserDir: The name of the directory that is appended onto a user's home
# directory if a ~user request is received.  Note that you must also set
# the default access control for these directories, as in the example below.
#
UserDir Sites

#
# Control access to UserDir directories.  The following is an example
# for a site where these directories are restricted to read-only.
#
Include /private/etc/apache2/users/*.conf
<IfModule bonjour_module>
       RegisterUserSite customized-users
</IfModule>
```

위의 파일 내용을 살펴보면 일단 위의 파일에서 `Include /private/etc/apache2/users/*.conf` 문장의 주석을 제거하고 해당 위치 즉, **/private/etc/apache2/users/** 폴더에 자신의 계정명으로 된 conf 파일을 만들어야 함을 알 수 있습니다. 

또한, `mod_authz_core`, `mod_authz_host`, `mod_userdir` 3개의 모듈을 사용하기 위해 기존의 **/private/etc/apache2/httpd.conf** 파일에서 해당 모듈들의 주석을 제거하고 **/private/etc/apache2/extra/httpd-userdir.conf** 파일을 include 하는 코드도 주석을 제거해 줘야 합니다.

Yesemite 이후로는 `mod_authz_host.so` 모듈과 `mod_authz_core.so` 모듈을 LoadModule하는 코드는 이미 주석이 제거되어 있는 상태입니다. 

`mod_userdir.so` 모듈을 LoadModule하는 코드의 주석을 제거해 줍니다.

`Include /private/etc/apache2/extra/httpd-userdir.conf` 부분의 주석을 제거해 줍니다. 윗줄에 **# User home directories**라는 제목이 붙어있습니다.

그리고 **/private/etc/apache2/users** 폴더에 (결국 **/etc/apache2/users** 폴더와 같은 모양입니다. 이부분은 아직 잘 모르겠습니다.) `username.conf` 파일을 만들어 줍니다.

Guest.conf 파일의 내용을 보면 권한설정이 Apache 2.2 기준으로 되어 있는데, 이와 같이 하면 동작하지 않습니다. 권한 설정 부분을 Apache 2.4 버전에 맞도록 작성해 줍니다. 내용은 다음과 같습니다.

```
<Directory "/Users/kimminho/Sites/">
  Options Indexes MultiViews
  AllowOverride None
  Require all granted
</Directory>
```

모든 설정을 완료했으면 아파치를 재시작합니다.

```
$ sudo apachectl restart
```

#### 아파치 종료하기 

실행중인 아파치를 종료하는 방법은 다음과 같습니다.

```
$ sudo apachectl stop
```

#### 아파치 설정 파일의 의미 

아파치 설정 파일에 대해서 정리합니다.[^acronym]

Options에서 Indexes는 DirectoryIndex로 설정한 index.html이나 index.php 파일이 없을 때, 디렉토리 인덱스를 보여주는 역할을 합니다. 

MultiViews는 클라이언트 요청에 따라 적절한 페이지를 보여줍니다. 예를 들면, Accept-Language:ko라면 한국어에 맞는 데이터를 전달해 줍니다. 

AllowOverride는 All로 설정함으로써 AccessFileName 설정에 따른 아파치 인증을 사용하도록 합니다.

Order allow, deny는 먼저 allow를 평가하고 이어서 deny 패턴을 체크한다는 순서를 정하는 것입니다.

Allow from all은 모든 것으로부터의 접속을 허용한다는 의미입니다. 순서도 allow 먼저 정의되어 있으므로 모든 곳에서 접속이 가능하게 됩니다. 

#### mod_wsgi 설치

### 아파치 VIRTUALHOST 설정

아파치 virtualhost 설정에 대해서는 여기에 잘 나와 있습니다. 

### 참고 자료

[mod_wsgi](https://modwsgi.readthedocs.io/en/develop/)

[Setting up the Apache WSGI module on OSX 10.9](http://www.jakowicz.com/setting-up-apache-wsgi-module-on-osx-10-9/)

[How to use Django with Apache and mod_wsgi](https://docs.djangoproject.com/en/1.10/howto/deployment/wsgi/modwsgi/)

[^projectjo]: [Mac 에 Apache 작동 시키기](http://projectjo.tistory.com/entry/Mac-에-Apache-작동-시키기) 2014년 글이라 현 시점에는 정확하지 않는 것 같습니다. 

[^acronym]: [MAC에서 Apache 실행하기](http://blog.acronym.co.kr/531) 맥에서 아파치를 실행하고 설정하는 방법에 대해서 자세하게 설명하고 있습니다. 다만 2015년 글이지만 OS X 마운틴라이언 버전에 대한 설명이라 지금과는 조금 맞지 않습니다. 

[^superakira]: [맥에서 기본 Apache 사용하기](http://superakira.tistory.com/entry/맥에서-기본-Apache-사용하기) 맥에서 아파치를 사용하는 방법에 대해서 간단하게 정리한 글입니다. 마찬가지로 전체 내용의 일부만 다루고 있습니다.

[^devmac]: [맥에 웹서버(Apache, PHP) 구동하기 - 요세미티 기준](http://devmac.tistory.com/11) 비교적 최신 자료이면서 설명이 잘 되어 있는 것 같습니다. 

[^apache]: [Apache HTTP Server Project](http://httpd.apache.org)

[CentOS: Apache(아파치) 설정파일 분석 - httpd.conf](http://webdir.tistory.com/178)

[Configuring Apache Virtual Hosts on Mac OS X](http://jason.pureconcepts.net/2014/11/configure-apache-virtualhost-mac-os-x/)

[아파치 VIRTUALHOST 설정](http://joont.tistory.com/46)
